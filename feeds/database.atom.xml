<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>寒玉 Blog - database</title><link href="xixuebin.github.io/" rel="alternate"></link><link href="xixuebin.github.io/feeds/database.atom.xml" rel="self"></link><id>xixuebin.github.io/</id><updated>2019-10-18T10:03:22+08:00</updated><entry><title>Debezium常见错误及处理</title><link href="xixuebin.github.io/2019-10-18-100322-ch.html" rel="alternate"></link><published>2019-10-18T10:03:22+08:00</published><updated>2019-10-18T10:03:22+08:00</updated><author><name>kevin.xi</name></author><id>tag:None,2019-10-18:xixuebin.github.io/2019-10-18-100322-ch.html</id><summary type="html">&lt;p&gt;Summary&lt;/p&gt;</summary><content type="html">&lt;!-- https://code.visualstudio.com/docs/editor/userdefinedsnippets --&gt;

&lt;h2&gt;mysql bin log 相关参数说明&lt;/h2&gt;
&lt;h3&gt;binlog-do-db&lt;/h3&gt;
&lt;p&gt;如果配置了该参数,则mysql只记录该数据库的相关操作到binlog中,没有配置的数据库则不记录&lt;/p&gt;
&lt;h3&gt;binlog_error_action&lt;/h3&gt;
&lt;p&gt;从MySQL 5.6.22版本开始，引入了一个新参数binlog_error_action (5.6.20及21版本叫做binlogging_impossible_mode)，若设置为ABORT_SERVER，则在发生binlog写入错误时直接让实例退出，避免引发更大的错误；若设置为IGNORE_ERROR，则忽略本次写入失败，同时禁止Binlog记录，需要重启才能让binlog再次开启。为了主备数据的强一致性，通常应该将binlog_error_action设置为ABORT_SERVER，这样在打开文件、rotate新文件、从IO Cache写binlog到文件出现磁盘错误时，都会退出实例。&lt;/p&gt;
&lt;h3&gt;sync_binlog&lt;/h3&gt;
&lt;p&gt;MySQL提供一个sync_binlog参数来控制数据库的binlog刷到磁盘上去。&lt;/p&gt;
&lt;p&gt;默认，sync_binlog=0，表示MySQL不控制binlog的刷新，由文件系统自己控制它的缓存的刷新。这时候的性能是最好的，但是风险也是最大的。因为一旦系统Crash，在binlog_cache中的所有binlog信息都会被丢失。&lt;/p&gt;
&lt;p&gt;如果sync_binlog&amp;gt;0，表示每sync_binlog次事务提交，MySQL调用文件系统的刷新操作将缓存刷下去。最安全的就是sync_binlog=1了，表示每次事务提交，MySQL都会把binlog刷下去，是最安全但是性能损耗最大的设置。这样的话，在数据库所在的主机操作系统损坏或者突然掉电的情况下，系统才有可能丢失1个事务的数据。但是binlog虽然是顺序IO，但是设置sync_binlog=1，多个事务同时提交，同样很大的影响MySQL和IO性能。虽然可以通过group commit的补丁缓解，但是刷新的频率过高对IO的影响也非常大。对于高并发事务的系统来说，“sync_binlog”设置为0和设置为1的系统写入性能差距可能高达5倍甚至更多。&lt;/p&gt;
&lt;p&gt;所以很多MySQL DBA设置的sync_binlog并不是最安全的1，而是100或者是0。这样牺牲一定的一致性，可以获得更高的并发和性能。&lt;/p&gt;
&lt;p&gt;&lt;em&gt;从以往经验和相关测试来看，对于高并发事务的系统来说，“sync_binlog”设置为0和设置为1的系统写入性能差距可能高达5倍甚至更多。&lt;/em&gt;&lt;/p&gt;
&lt;h3&gt;binlog_row_image&lt;/h3&gt;
&lt;p&gt;MySQL 5.7以后binlog的格式默认就是ROW了，同时引入了新的参数binlog_row_image，这个参数默认值是FULL，其还有一个值是minimal。&lt;/p&gt;
&lt;p&gt;FULL记录每一行的变更，minimal只记录影响后的行。下面简单的测试一下大家就明白了。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;mysql&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;show&lt;/span&gt; &lt;span class="n"&gt;variables&lt;/span&gt; &lt;span class="k"&gt;like&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;%row_im%&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;------------------+-------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Variable_name&lt;/span&gt;    &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Value&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;------------------+-------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;binlog_row_image&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="k"&gt;FULL&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;------------------+-------+&lt;/span&gt;
&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="k"&gt;row&lt;/span&gt; &lt;span class="k"&gt;in&lt;/span&gt; &lt;span class="k"&gt;set&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;01&lt;/span&gt; &lt;span class="n"&gt;sec&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;mysql&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;update&lt;/span&gt; &lt;span class="n"&gt;t2&lt;/span&gt; &lt;span class="k"&gt;set&lt;/span&gt; &lt;span class="n"&gt;uid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;99&lt;/span&gt; &lt;span class="k"&gt;where&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;yayundeng&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="n"&gt;Query&lt;/span&gt; &lt;span class="n"&gt;OK&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="k"&gt;row&lt;/span&gt; &lt;span class="n"&gt;affected&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;03&lt;/span&gt; &lt;span class="n"&gt;sec&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;Rows&lt;/span&gt; &lt;span class="n"&gt;matched&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;  &lt;span class="n"&gt;Changed&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;  &lt;span class="n"&gt;Warnings&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;

&lt;span class="n"&gt;mysql&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;解析binlog&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="o"&gt;@&lt;/span&gt;&lt;span class="n"&gt;yayundeng&lt;/span&gt; &lt;span class="mi"&gt;3306&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;#&lt;/span&gt; &lt;span class="n"&gt;mysqlbinlog&lt;/span&gt; &lt;span class="c1"&gt;--no-defaults -v -v --base64-output=DECODE-ROWS mysql-bin.000010 | tail -n 20&lt;/span&gt;
&lt;span class="o"&gt;#&lt;/span&gt;&lt;span class="mi"&gt;161210&lt;/span&gt; &lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt; &lt;span class="n"&gt;server&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="mi"&gt;152&lt;/span&gt;  &lt;span class="n"&gt;end_log_pos&lt;/span&gt; &lt;span class="mi"&gt;2043&lt;/span&gt; &lt;span class="n"&gt;CRC32&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="n"&gt;x3ce8a225&lt;/span&gt;       &lt;span class="n"&gt;Update_rows&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;table&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="mi"&gt;110&lt;/span&gt; &lt;span class="n"&gt;flags&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;STMT_END_F&lt;/span&gt;
&lt;span class="o"&gt;###&lt;/span&gt; &lt;span class="k"&gt;UPDATE&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;test&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;t2&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;
&lt;span class="o"&gt;###&lt;/span&gt; &lt;span class="k"&gt;WHERE&lt;/span&gt;
&lt;span class="o"&gt;###&lt;/span&gt;   &lt;span class="o"&gt;@&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="cm"&gt;/* INT meta=0 nullable=0 is_null=0 */&lt;/span&gt;
&lt;span class="o"&gt;###&lt;/span&gt;   &lt;span class="o"&gt;@&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gz&amp;#39;&lt;/span&gt; &lt;span class="cm"&gt;/* STRING(20) meta=65044 nullable=1 is_null=0 */&lt;/span&gt;
&lt;span class="o"&gt;###&lt;/span&gt;   &lt;span class="o"&gt;@&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;yayundeng&amp;#39;&lt;/span&gt; &lt;span class="cm"&gt;/* STRING(20) meta=65044 nullable=1 is_null=0 */&lt;/span&gt;
&lt;span class="o"&gt;###&lt;/span&gt;   &lt;span class="o"&gt;@&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="cm"&gt;/* INT meta=0 nullable=1 is_null=0 */&lt;/span&gt;
&lt;span class="o"&gt;###&lt;/span&gt; &lt;span class="k"&gt;SET&lt;/span&gt;
&lt;span class="o"&gt;###&lt;/span&gt;   &lt;span class="o"&gt;@&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="cm"&gt;/* INT meta=0 nullable=0 is_null=0 */&lt;/span&gt;
&lt;span class="o"&gt;###&lt;/span&gt;   &lt;span class="o"&gt;@&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gz&amp;#39;&lt;/span&gt; &lt;span class="cm"&gt;/* STRING(20) meta=65044 nullable=1 is_null=0 */&lt;/span&gt;
&lt;span class="o"&gt;###&lt;/span&gt;   &lt;span class="o"&gt;@&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;yayundeng&amp;#39;&lt;/span&gt; &lt;span class="cm"&gt;/* STRING(20) meta=65044 nullable=1 is_null=0 */&lt;/span&gt;
&lt;span class="o"&gt;###&lt;/span&gt;   &lt;span class="o"&gt;@&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;99&lt;/span&gt; &lt;span class="cm"&gt;/* INT meta=0 nullable=1 is_null=0 */&lt;/span&gt;
&lt;span class="o"&gt;#&lt;/span&gt; &lt;span class="k"&gt;at&lt;/span&gt; &lt;span class="mi"&gt;2043&lt;/span&gt;
&lt;span class="o"&gt;#&lt;/span&gt;&lt;span class="mi"&gt;161210&lt;/span&gt; &lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt; &lt;span class="n"&gt;server&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="mi"&gt;152&lt;/span&gt;  &lt;span class="n"&gt;end_log_pos&lt;/span&gt; &lt;span class="mi"&gt;2074&lt;/span&gt; &lt;span class="n"&gt;CRC32&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="n"&gt;x93619126&lt;/span&gt;       &lt;span class="n"&gt;Xid&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;49&lt;/span&gt;
&lt;span class="k"&gt;COMMIT&lt;/span&gt;&lt;span class="cm"&gt;/*!*/&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;SET&lt;/span&gt; &lt;span class="o"&gt;@@&lt;/span&gt;&lt;span class="k"&gt;SESSION&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GTID_NEXT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;AUTOMATIC&amp;#39;&lt;/span&gt; &lt;span class="cm"&gt;/* added by mysqlbinlog */&lt;/span&gt; &lt;span class="cm"&gt;/*!*/&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;DELIMITER&lt;/span&gt; &lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="o"&gt;#&lt;/span&gt; &lt;span class="k"&gt;End&lt;/span&gt; &lt;span class="k"&gt;of&lt;/span&gt; &lt;span class="n"&gt;log&lt;/span&gt; &lt;span class="n"&gt;file&lt;/span&gt;
&lt;span class="cm"&gt;/*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="cm"&gt;/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="o"&gt;@&lt;/span&gt;&lt;span class="n"&gt;yayundeng&lt;/span&gt; &lt;span class="mi"&gt;3306&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;#&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;cdc 参数说明&lt;/h2&gt;
&lt;h3&gt;database.history.store.only.monitored.tables.ddl&lt;/h3&gt;
&lt;p&gt;布尔值，指定连接器是否应记录所有DDL语句，或者（如果为true）仅记录与Debezium（通过筛选器配置）监视的表相关的语句。安全默认值为false。应小心使用此功能，因为更改筛选器时可能需要缺少数据。&lt;/p&gt;
&lt;h2&gt;错误一&lt;/h2&gt;
&lt;p&gt;错误描述&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;org.apache.kafka.connect.errors.ConnectException
    at io.debezium.connector.mysql.AbstractReader.wrap&lt;span class="o"&gt;(&lt;/span&gt;AbstractReader.java:230&lt;span class="o"&gt;)&lt;/span&gt;
    at io.debezium.connector.mysql.AbstractReader.failed&lt;span class="o"&gt;(&lt;/span&gt;AbstractReader.java:197&lt;span class="o"&gt;)&lt;/span&gt;
    at io.debezium.connector.mysql.BinlogReader&lt;span class="nv"&gt;$ReaderThreadLifecycleListener&lt;/span&gt;.onCommunicationFailure&lt;span class="o"&gt;(&lt;/span&gt;BinlogReader.java:1018&lt;span class="o"&gt;)&lt;/span&gt;
    at com.github.shyiko.mysql.binlog.BinaryLogClient.listenForEventPackets&lt;span class="o"&gt;(&lt;/span&gt;BinaryLogClient.java:950&lt;span class="o"&gt;)&lt;/span&gt;
    at com.github.shyiko.mysql.binlog.BinaryLogClient.connect&lt;span class="o"&gt;(&lt;/span&gt;BinaryLogClient.java:580&lt;span class="o"&gt;)&lt;/span&gt;
    at com.github.shyiko.mysql.binlog.BinaryLogClient&lt;span class="nv"&gt;$7&lt;/span&gt;.run&lt;span class="o"&gt;(&lt;/span&gt;BinaryLogClient.java:825&lt;span class="o"&gt;)&lt;/span&gt;
    at java.lang.Thread.run&lt;span class="o"&gt;(&lt;/span&gt;Thread.java:745&lt;span class="o"&gt;)&lt;/span&gt;
Caused by: java.io.EOFException
    at com.github.shyiko.mysql.binlog.io.ByteArrayInputStream.read&lt;span class="o"&gt;(&lt;/span&gt;ByteArrayInputStream.java:190&lt;span class="o"&gt;)&lt;/span&gt;
    at com.github.shyiko.mysql.binlog.io.ByteArrayInputStream.readInteger&lt;span class="o"&gt;(&lt;/span&gt;ByteArrayInputStream.java:46&lt;span class="o"&gt;)&lt;/span&gt;
    at com.github.shyiko.mysql.binlog.event.deserialization.EventHeaderV4Deserializer.deserialize&lt;span class="o"&gt;(&lt;/span&gt;EventHeaderV4Deserializer.java:35&lt;span class="o"&gt;)&lt;/span&gt;
    at com.github.shyiko.mysql.binlog.event.deserialization.EventHeaderV4Deserializer.deserialize&lt;span class="o"&gt;(&lt;/span&gt;EventHeaderV4Deserializer.java:27&lt;span class="o"&gt;)&lt;/span&gt;
    at com.github.shyiko.mysql.binlog.event.deserialization.EventDeserializer.nextEvent&lt;span class="o"&gt;(&lt;/span&gt;EventDeserializer.java:212&lt;span class="o"&gt;)&lt;/span&gt;
    at io.debezium.connector.mysql.BinlogReader&lt;span class="nv"&gt;$1&lt;/span&gt;.nextEvent&lt;span class="o"&gt;(&lt;/span&gt;BinlogReader.java:224&lt;span class="o"&gt;)&lt;/span&gt;
    at com.github.shyiko.mysql.binlog.BinaryLogClient.listenForEventPackets&lt;span class="o"&gt;(&lt;/span&gt;BinaryLogClient.java:922&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;一般该错误是在CDC connector所连接的数据库宕机或者重启的情况下出现的.且在重启完成之后,不会自动变为running状态.&lt;/p&gt;
&lt;h3&gt;解决办法&lt;/h3&gt;
&lt;p&gt;重启该connector即可恢复正常.&lt;/p&gt;
&lt;h2&gt;错误二&lt;/h2&gt;
&lt;p&gt;错误描述&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;org.apache.kafka.connect.errors.ConnectException: could not find next log&lt;span class="p"&gt;;&lt;/span&gt; the first event &lt;span class="s1"&gt;&amp;#39;binlog.000030&amp;#39;&lt;/span&gt; at &lt;span class="m"&gt;155&lt;/span&gt;, the last event &lt;span class="nb"&gt;read&lt;/span&gt; from &lt;span class="s1"&gt;&amp;#39;./binlog.000030&amp;#39;&lt;/span&gt; at &lt;span class="m"&gt;124&lt;/span&gt;, the last byte &lt;span class="nb"&gt;read&lt;/span&gt; from &lt;span class="s1"&gt;&amp;#39;./binlog.000030&amp;#39;&lt;/span&gt; at &lt;span class="m"&gt;155&lt;/span&gt;. Error code: &lt;span class="m"&gt;1236&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; SQLSTATE: HY000.
    at io.debezium.connector.mysql.AbstractReader.wrap&lt;span class="o"&gt;(&lt;/span&gt;AbstractReader.java:230&lt;span class="o"&gt;)&lt;/span&gt;
    at io.debezium.connector.mysql.AbstractReader.failed&lt;span class="o"&gt;(&lt;/span&gt;AbstractReader.java:197&lt;span class="o"&gt;)&lt;/span&gt;
    at io.debezium.connector.mysql.BinlogReader&lt;span class="nv"&gt;$ReaderThreadLifecycleListener&lt;/span&gt;.onCommunicationFailure&lt;span class="o"&gt;(&lt;/span&gt;BinlogReader.java:1018&lt;span class="o"&gt;)&lt;/span&gt;
    at com.github.shyiko.mysql.binlog.BinaryLogClient.listenForEventPackets&lt;span class="o"&gt;(&lt;/span&gt;BinaryLogClient.java:950&lt;span class="o"&gt;)&lt;/span&gt;
    at com.github.shyiko.mysql.binlog.BinaryLogClient.connect&lt;span class="o"&gt;(&lt;/span&gt;BinaryLogClient.java:580&lt;span class="o"&gt;)&lt;/span&gt;
    at com.github.shyiko.mysql.binlog.BinaryLogClient&lt;span class="nv"&gt;$7&lt;/span&gt;.run&lt;span class="o"&gt;(&lt;/span&gt;BinaryLogClient.java:825&lt;span class="o"&gt;)&lt;/span&gt;
    at java.lang.Thread.run&lt;span class="o"&gt;(&lt;/span&gt;Thread.java:745&lt;span class="o"&gt;)&lt;/span&gt;
Caused by: com.github.shyiko.mysql.binlog.network.ServerException: could not find next log&lt;span class="p"&gt;;&lt;/span&gt; the first event &lt;span class="s1"&gt;&amp;#39;binlog.000030&amp;#39;&lt;/span&gt; at &lt;span class="m"&gt;155&lt;/span&gt;, the last event &lt;span class="nb"&gt;read&lt;/span&gt; from &lt;span class="s1"&gt;&amp;#39;./binlog.000030&amp;#39;&lt;/span&gt; at &lt;span class="m"&gt;124&lt;/span&gt;, the last byte &lt;span class="nb"&gt;read&lt;/span&gt; from &lt;span class="s1"&gt;&amp;#39;./binlog.000030&amp;#39;&lt;/span&gt; at &lt;span class="m"&gt;155&lt;/span&gt;.
    at com.github.shyiko.mysql.binlog.BinaryLogClient.listenForEventPackets&lt;span class="o"&gt;(&lt;/span&gt;BinaryLogClient.java:914&lt;span class="o"&gt;)&lt;/span&gt;
    ... &lt;span class="m"&gt;3&lt;/span&gt; more
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;改错误的出现,因为执行了一次&lt;code&gt;reset master&lt;/code&gt;,清除了mysql的binlog日志,日志文件从新的000001开始了,导致cdc不能找到binlog文件.&lt;/p&gt;
&lt;h3&gt;解决办法&lt;/h3&gt;
&lt;p&gt;重启该connector即可恢复正常.&lt;/p&gt;
&lt;h2&gt;错误三&lt;/h2&gt;
&lt;p&gt;错误描述&lt;/p&gt;
&lt;p&gt;CDC的主域名可以访问通,但是获取不了connectors,即&lt;a href="http://localhost:8083/"&gt;http://localhost:8083/&lt;/a&gt;可以正常返回,但是&lt;a href="http://localhost:8083/connectors"&gt;http://localhost:8083/connectors&lt;/a&gt;请求超时.&lt;/p&gt;
&lt;h3&gt;解决办法&lt;/h3&gt;
&lt;p&gt;该问题一般是CDC连接kafka失败.请价差kafka状态.连接上kafka之后,改问题会自动恢复&lt;/p&gt;
&lt;h2&gt;错误四&lt;/h2&gt;
&lt;p&gt;错误描述&lt;/p&gt;
&lt;p&gt;CDC connector状态正常,kafka状态也这很正常,binlog会产生日志,但是kafka收不到消息.&lt;/p&gt;
&lt;h3&gt;解决办法&lt;/h3&gt;
&lt;p&gt;各类错误一般是connector的配置错误,请检查connector的注册信息.包括&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;table.whitelist选项的表名称前是否携带数据库信息.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;错误五&lt;/h2&gt;
&lt;p&gt;错误描述&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;org.apache.kafka.connect.errors.ConnectException: Could not open log file Error code: &lt;span class="m"&gt;1236&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; SQLSTATE: HY000.
    at io.debezium.connector.mysql.AbstractReader.wrap&lt;span class="o"&gt;(&lt;/span&gt;AbstractReader.java:230&lt;span class="o"&gt;)&lt;/span&gt;
    at io.debezium.connector.mysql.AbstractReader.failed&lt;span class="o"&gt;(&lt;/span&gt;AbstractReader.java:197&lt;span class="o"&gt;)&lt;/span&gt;
    at io.debezium.connector.mysql.BinlogReader&lt;span class="nv"&gt;$ReaderThreadLifecycleListener&lt;/span&gt;.onCommunicationFailure&lt;span class="o"&gt;(&lt;/span&gt;BinlogReader.java:1018&lt;span class="o"&gt;)&lt;/span&gt;
    at com.github.shyiko.mysql.binlog.BinaryLogClient.listenForEventPackets&lt;span class="o"&gt;(&lt;/span&gt;BinaryLogClient.java:950&lt;span class="o"&gt;)&lt;/span&gt;
    at com.github.shyiko.mysql.binlog.BinaryLogClient.connect&lt;span class="o"&gt;(&lt;/span&gt;BinaryLogClient.java:580&lt;span class="o"&gt;)&lt;/span&gt;
    at com.github.shyiko.mysql.binlog.BinaryLogClient&lt;span class="nv"&gt;$7&lt;/span&gt;.run&lt;span class="o"&gt;(&lt;/span&gt;BinaryLogClient.java:825&lt;span class="o"&gt;)&lt;/span&gt;
    at java.lang.Thread.run&lt;span class="o"&gt;(&lt;/span&gt;Thread.java:745&lt;span class="o"&gt;)&lt;/span&gt;
Caused by: com.github.shyiko.mysql.binlog.network.ServerException: Could not open log file
    at com.github.shyiko.mysql.binlog.BinaryLogClient.listenForEventPackets&lt;span class="o"&gt;(&lt;/span&gt;BinaryLogClient.java:914&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;该错误一般是由于当前正在使用的binlog文件丢失,或者由于目中原因不能写入造成的.&lt;/p&gt;
&lt;h3&gt;解决办法&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;运行命令&lt;code&gt;show master logs;&lt;/code&gt;,查看最新的binlog文件名.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;P&lt;img alt="2019-10-18-16-19-21" src="http://xixuebin-blog-images.oss-cn-beijing.aliyuncs.com/xixuebin-blog-images.oss-cn-beijing.aliyuncs.com/images/67242febe1cece2c50ece0c17ed27205.png"&gt;&lt;/p&gt;
&lt;p&gt;运行命名&lt;code&gt;show binlog events in 'binlog.000003';&lt;/code&gt;,查看最新binlog中的事件.&lt;/p&gt;
&lt;p&gt;P&lt;img alt="2019-10-18-16-20-32" src="http://xixuebin-blog-images.oss-cn-beijing.aliyuncs.com/xixuebin-blog-images.oss-cn-beijing.aliyuncs.com/images/def104c7d681600dcd40b62344b41efb.png"&gt;&lt;/p&gt;
&lt;p&gt;如果显示如图所示,则证明文件已经丢失.请查看日志文件.再找回日志文件后重启connector.&lt;/p&gt;
&lt;h2&gt;错误六&lt;/h2&gt;
&lt;p&gt;错误描述&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;org.apache.kafka.connect.errors.ConnectException: The connector is trying to &lt;span class="nb"&gt;read&lt;/span&gt; binlog starting at binlog file &lt;span class="s1"&gt;&amp;#39;mariadb-bin.000003&amp;#39;&lt;/span&gt;, &lt;span class="nv"&gt;pos&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;63317395&lt;/span&gt;, skipping &lt;span class="m"&gt;0&lt;/span&gt; events plus &lt;span class="m"&gt;1&lt;/span&gt; rows, but this is no longer available on the server. Reconfigure the connector to use a snapshot when needed.
    at io.debezium.connector.mysql.MySqlConnectorTask.start&lt;span class="o"&gt;(&lt;/span&gt;MySqlConnectorTask.java:127&lt;span class="o"&gt;)&lt;/span&gt;
    at io.debezium.connector.common.BaseSourceTask.start&lt;span class="o"&gt;(&lt;/span&gt;BaseSourceTask.java:49&lt;span class="o"&gt;)&lt;/span&gt;
    at org.apache.kafka.connect.runtime.WorkerSourceTask.execute&lt;span class="o"&gt;(&lt;/span&gt;WorkerSourceTask.java:198&lt;span class="o"&gt;)&lt;/span&gt;
    at org.apache.kafka.connect.runtime.WorkerTask.doRun&lt;span class="o"&gt;(&lt;/span&gt;WorkerTask.java:175&lt;span class="o"&gt;)&lt;/span&gt;
    at org.apache.kafka.connect.runtime.WorkerTask.run&lt;span class="o"&gt;(&lt;/span&gt;WorkerTask.java:219&lt;span class="o"&gt;)&lt;/span&gt;
    at java.util.concurrent.Executors&lt;span class="nv"&gt;$RunnableAdapter&lt;/span&gt;.call&lt;span class="o"&gt;(&lt;/span&gt;Executors.java:511&lt;span class="o"&gt;)&lt;/span&gt;
    at java.util.concurrent.FutureTask.run&lt;span class="o"&gt;(&lt;/span&gt;FutureTask.java:266&lt;span class="o"&gt;)&lt;/span&gt;
    at java.util.concurrent.ThreadPoolExecutor.runWorker&lt;span class="o"&gt;(&lt;/span&gt;ThreadPoolExecutor.java:1149&lt;span class="o"&gt;)&lt;/span&gt;
    at java.util.concurrent.ThreadPoolExecutor&lt;span class="nv"&gt;$Worker&lt;/span&gt;.run&lt;span class="o"&gt;(&lt;/span&gt;ThreadPoolExecutor.java:624&lt;span class="o"&gt;)&lt;/span&gt;
    at java.lang.Thread.run&lt;span class="o"&gt;(&lt;/span&gt;Thread.java:748&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;该错误是connector所要寻找的binlog已经不在了,无法读取.有可能是因为过期导致的.&lt;/p&gt;
&lt;h3&gt;解决办法&lt;/h3&gt;
&lt;p&gt;更新connector,snapshot.mode参数使用when_needed参数.&lt;/p&gt;
&lt;h2&gt;错误七&lt;/h2&gt;
&lt;p&gt;在注册connector的时候,返回400错误,错误信息如下:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;error_code&amp;quot;&lt;/span&gt;:400,&lt;span class="s2"&gt;&amp;quot;message&amp;quot;&lt;/span&gt;:&lt;span class="s2"&gt;&amp;quot;Connector configuration is invalid and contains the following 1 error(s):\nUnable to connect: Communications link failure\n\nThe last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.\nYou can also find the above list of errors at the endpoint `/{connectorType}/config/validate`&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;该错误一般是由于我们注册的时候,填写的mysql的配置信息有问题,导致connector连接不上mysql数据库导致的.&lt;/p&gt;
&lt;h3&gt;解决办法&lt;/h3&gt;
&lt;p&gt;检查注册信息中的connector配置,特别是mysql链接相关的配置后,重新注册&lt;/p&gt;
&lt;h2&gt;参考&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.percona.com/blog/2014/10/08/mysql-replication-got-fatal-error-1236-causes-and-cures/"&gt;https://www.percona.com/blog/2014/10/08/mysql-replication-got-fatal-error-1236-causes-and-cures/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/zendesk/maxwell/issues/1083"&gt;https://github.com/zendesk/maxwell/issues/1083&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://gitter.im/debezium/dev/archives/2019/05/07"&gt;https://gitter.im/debezium/dev/archives/2019/05/07&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><category term="database"></category><category term="CDC"></category></entry><entry><title>Debezium趟坑记录</title><link href="xixuebin.github.io/2019-07-19-151913-ch.html" rel="alternate"></link><published>2019-07-19T15:19:13+08:00</published><updated>2019-07-19T15:19:13+08:00</updated><author><name>kevin.xi</name></author><id>tag:None,2019-07-19:xixuebin.github.io/2019-07-19-151913-ch.html</id><summary type="html">&lt;p&gt;Summary&lt;/p&gt;</summary><content type="html">&lt;!-- https://code.visualstudio.com/docs/editor/userdefinedsnippets --&gt;

&lt;h1&gt;Debezium趟坑记录&lt;/h1&gt;
&lt;h2&gt;创建表导致connector报错&lt;/h2&gt;
&lt;p&gt;这几天发现Debezium上注册的mysql connector 在报一个错误,错误信息如下:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;org.apache.kafka.connect.errors.ConnectException: Maximum width must be from &lt;span class="m"&gt;1&lt;/span&gt; to &lt;span class="m"&gt;9&lt;/span&gt; inclusive but was &lt;span class="m"&gt;0&lt;/span&gt;
    at io.debezium.connector.mysql.AbstractReader.wrap&lt;span class="o"&gt;(&lt;/span&gt;AbstractReader.java:230&lt;span class="o"&gt;)&lt;/span&gt;
    at io.debezium.connector.mysql.AbstractReader.failed&lt;span class="o"&gt;(&lt;/span&gt;AbstractReader.java:208&lt;span class="o"&gt;)&lt;/span&gt;
    at io.debezium.connector.mysql.BinlogReader.handleEvent&lt;span class="o"&gt;(&lt;/span&gt;BinlogReader.java:508&lt;span class="o"&gt;)&lt;/span&gt;
    at com.github.shyiko.mysql.binlog.BinaryLogClient.notifyEventListeners&lt;span class="o"&gt;(&lt;/span&gt;BinaryLogClient.java:1095&lt;span class="o"&gt;)&lt;/span&gt;
    at com.github.shyiko.mysql.binlog.BinaryLogClient.listenForEventPackets&lt;span class="o"&gt;(&lt;/span&gt;BinaryLogClient.java:943&lt;span class="o"&gt;)&lt;/span&gt;
    at com.github.shyiko.mysql.binlog.BinaryLogClient.connect&lt;span class="o"&gt;(&lt;/span&gt;BinaryLogClient.java:580&lt;span class="o"&gt;)&lt;/span&gt;
    at com.github.shyiko.mysql.binlog.BinaryLogClient&lt;span class="nv"&gt;$7&lt;/span&gt;.run&lt;span class="o"&gt;(&lt;/span&gt;BinaryLogClient.java:825&lt;span class="o"&gt;)&lt;/span&gt;
    at java.lang.Thread.run&lt;span class="o"&gt;(&lt;/span&gt;Thread.java:748&lt;span class="o"&gt;)&lt;/span&gt;
Caused by: java.lang.IllegalArgumentException: Maximum width must be from &lt;span class="m"&gt;1&lt;/span&gt; to &lt;span class="m"&gt;9&lt;/span&gt; inclusive but was &lt;span class="m"&gt;0&lt;/span&gt;
    at java.time.format.DateTimeFormatterBuilder&lt;span class="nv"&gt;$FractionPrinterParser&lt;/span&gt;.&amp;lt;init&amp;gt;&lt;span class="o"&gt;(&lt;/span&gt;DateTimeFormatterBuilder.java:2922&lt;span class="o"&gt;)&lt;/span&gt;
    at java.time.format.DateTimeFormatterBuilder.appendFraction&lt;span class="o"&gt;(&lt;/span&gt;DateTimeFormatterBuilder.java:687&lt;span class="o"&gt;)&lt;/span&gt;
    at io.debezium.connector.mysql.MySqlDefaultValuePreConverter.timestampFormat&lt;span class="o"&gt;(&lt;/span&gt;MySqlDefaultValuePreConverter.java:239&lt;span class="o"&gt;)&lt;/span&gt;
    at io.debezium.connector.mysql.MySqlDefaultValuePreConverter.convertToLocalDateTime&lt;span class="o"&gt;(&lt;/span&gt;MySqlDefaultValuePreConverter.java:129&lt;span class="o"&gt;)&lt;/span&gt;
    at io.debezium.connector.mysql.MySqlDefaultValuePreConverter.convert&lt;span class="o"&gt;(&lt;/span&gt;MySqlDefaultValuePreConverter.java:68&lt;span class="o"&gt;)&lt;/span&gt;
    at io.debezium.connector.mysql.antlr.listener.ColumnDefinitionParserListener.convertDefaultValueToSchemaType&lt;span class="o"&gt;(&lt;/span&gt;ColumnDefinitionParserListener.java:303&lt;span class="o"&gt;)&lt;/span&gt;
    at io.debezium.connector.mysql.antlr.listener.ColumnDefinitionParserListener.enterDefaultValue&lt;span class="o"&gt;(&lt;/span&gt;ColumnDefinitionParserListener.java:142&lt;span class="o"&gt;)&lt;/span&gt;
    at io.debezium.ddl.parser.mysql.generated.MySqlParser&lt;span class="nv"&gt;$DefaultValueContext&lt;/span&gt;.enterRule&lt;span class="o"&gt;(&lt;/span&gt;MySqlParser.java:46698&lt;span class="o"&gt;)&lt;/span&gt;
    at io.debezium.antlr.ProxyParseTreeListenerUtil.delegateEnterRule&lt;span class="o"&gt;(&lt;/span&gt;ProxyParseTreeListenerUtil.java:46&lt;span class="o"&gt;)&lt;/span&gt;
    at io.debezium.connector.mysql.antlr.listener.MySqlAntlrDdlParserListener.enterEveryRule&lt;span class="o"&gt;(&lt;/span&gt;MySqlAntlrDdlParserListener.java:89&lt;span class="o"&gt;)&lt;/span&gt;
    at org.antlr.v4.runtime.tree.ParseTreeWalker.enterRule&lt;span class="o"&gt;(&lt;/span&gt;ParseTreeWalker.java:41&lt;span class="o"&gt;)&lt;/span&gt;
    at org.antlr.v4.runtime.tree.ParseTreeWalker.walk&lt;span class="o"&gt;(&lt;/span&gt;ParseTreeWalker.java:25&lt;span class="o"&gt;)&lt;/span&gt;
    at org.antlr.v4.runtime.tree.ParseTreeWalker.walk&lt;span class="o"&gt;(&lt;/span&gt;ParseTreeWalker.java:28&lt;span class="o"&gt;)&lt;/span&gt;
    at org.antlr.v4.runtime.tree.ParseTreeWalker.walk&lt;span class="o"&gt;(&lt;/span&gt;ParseTreeWalker.java:28&lt;span class="o"&gt;)&lt;/span&gt;
    at org.antlr.v4.runtime.tree.ParseTreeWalker.walk&lt;span class="o"&gt;(&lt;/span&gt;ParseTreeWalker.java:28&lt;span class="o"&gt;)&lt;/span&gt;
    at org.antlr.v4.runtime.tree.ParseTreeWalker.walk&lt;span class="o"&gt;(&lt;/span&gt;ParseTreeWalker.java:28&lt;span class="o"&gt;)&lt;/span&gt;
    at org.antlr.v4.runtime.tree.ParseTreeWalker.walk&lt;span class="o"&gt;(&lt;/span&gt;ParseTreeWalker.java:28&lt;span class="o"&gt;)&lt;/span&gt;
    at org.antlr.v4.runtime.tree.ParseTreeWalker.walk&lt;span class="o"&gt;(&lt;/span&gt;ParseTreeWalker.java:28&lt;span class="o"&gt;)&lt;/span&gt;
    at org.antlr.v4.runtime.tree.ParseTreeWalker.walk&lt;span class="o"&gt;(&lt;/span&gt;ParseTreeWalker.java:28&lt;span class="o"&gt;)&lt;/span&gt;
    at org.antlr.v4.runtime.tree.ParseTreeWalker.walk&lt;span class="o"&gt;(&lt;/span&gt;ParseTreeWalker.java:28&lt;span class="o"&gt;)&lt;/span&gt;
    at org.antlr.v4.runtime.tree.ParseTreeWalker.walk&lt;span class="o"&gt;(&lt;/span&gt;ParseTreeWalker.java:28&lt;span class="o"&gt;)&lt;/span&gt;
    at io.debezium.antlr.AntlrDdlParser.parse&lt;span class="o"&gt;(&lt;/span&gt;AntlrDdlParser.java:85&lt;span class="o"&gt;)&lt;/span&gt;
    at io.debezium.connector.mysql.MySqlSchema.applyDdl&lt;span class="o"&gt;(&lt;/span&gt;MySqlSchema.java:307&lt;span class="o"&gt;)&lt;/span&gt;
    at io.debezium.connector.mysql.BinlogReader.handleQueryEvent&lt;span class="o"&gt;(&lt;/span&gt;BinlogReader.java:694&lt;span class="o"&gt;)&lt;/span&gt;
    at io.debezium.connector.mysql.BinlogReader.handleEvent&lt;span class="o"&gt;(&lt;/span&gt;BinlogReader.java:492&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;很明显是一个日期格式解析的错误,但是会是什么日期呢,根据错误日志,往回翻了下日志,找到了相联系的上次条出错日志&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-07-19 &lt;span class="m"&gt;09&lt;/span&gt;:38:05,247&lt;span class="o"&gt;]&lt;/span&gt; ERROR Error during binlog processing. Last offset &lt;span class="nv"&gt;stored&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;&lt;span class="nv"&gt;ts_sec&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1562746455&lt;/span&gt;, &lt;span class="nv"&gt;file&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;mariadb-bin.000018, &lt;span class="nv"&gt;pos&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;58777691&lt;/span&gt;, &lt;span class="nv"&gt;row&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;, &lt;span class="nv"&gt;server_id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;, &lt;span class="nv"&gt;event&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;6&lt;/span&gt;&lt;span class="o"&gt;}&lt;/span&gt;, binlog reader near &lt;span class="nv"&gt;position&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; mariadb-bin.000018/67582355 &lt;span class="o"&gt;(&lt;/span&gt;io.debezium.connector.mysql.BinlogReader:1054&lt;span class="o"&gt;)[&lt;/span&gt;&lt;span class="m"&gt;2019&lt;/span&gt;-07-19 &lt;span class="m"&gt;09&lt;/span&gt;:38:05,247&lt;span class="o"&gt;]&lt;/span&gt; TRACE Received event: Event&lt;span class="o"&gt;{&lt;/span&gt;&lt;span class="nv"&gt;header&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;EventHeaderV4&lt;span class="o"&gt;{&lt;/span&gt;&lt;span class="nv"&gt;timestamp&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1562642991000&lt;/span&gt;, &lt;span class="nv"&gt;eventType&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;QUERY, &lt;span class="nv"&gt;serverId&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;, &lt;span class="nv"&gt;headerLength&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;19&lt;/span&gt;, &lt;span class="nv"&gt;dataLength&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;356&lt;/span&gt;, &lt;span class="nv"&gt;nextPosition&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;95707350&lt;/span&gt;, &lt;span class="nv"&gt;flags&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;8&lt;/span&gt;&lt;span class="o"&gt;}&lt;/span&gt;, &lt;span class="nv"&gt;data&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;QueryEventData&lt;span class="o"&gt;{&lt;/span&gt;&lt;span class="nv"&gt;threadId&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;, &lt;span class="nv"&gt;executionTime&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;,errorCode&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;, &lt;span class="nv"&gt;database&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;, &lt;span class="nv"&gt;sql&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="c1"&gt;# Dummy event replacing event type 160 that slave cannot handle.&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;上面的日志给出了具体出错的binlog所在的文件和位置.dump出具体的binlog内容,查看&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# 开始位置必须是我们日志中的位置,结束位置根据你期望看到的日志大小,增加一个值.这里我增加了2000&lt;/span&gt;
mysqlbinlog --start-position&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;67582355&amp;quot;&lt;/span&gt; --stop-position&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;67584355&amp;quot;&lt;/span&gt; /opt/data/mariadb-bin.000018

&lt;span class="c1"&gt;#bin log 内容如下&lt;/span&gt;

root@mariadb-1-598c45cfb9-kf6rt:/var/log/mysql# mysqlbinlog --start-position&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;67582355&amp;quot;&lt;/span&gt; --stop-position&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;67585355&amp;quot;&lt;/span&gt; /var/log/mysql/mariadb-bin.000018
/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;*/&lt;span class="p"&gt;;&lt;/span&gt;
/*!40019 SET @@session.max_insert_delayed_threads&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;*/&lt;span class="p"&gt;;&lt;/span&gt;
/*!50003 SET @OLD_COMPLETION_TYPE&lt;span class="o"&gt;=&lt;/span&gt;@@COMPLETION_TYPE,COMPLETION_TYPE&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;*/&lt;span class="p"&gt;;&lt;/span&gt;
DELIMITER /*!*/&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="c1"&gt;# at 4&lt;/span&gt;
&lt;span class="c1"&gt;#190709  3:31:18 server id 1  end_log_pos 256 CRC32 0x9f4535ee  Start: binlog v 4, server v 10.3.10-MariaDB-1:10.3.10+maria~bionic-log created 190709  3:31:18&lt;/span&gt;
BINLOG &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;hgokXQ8BAAAA/AAAAAABAAAAAAQAMTAuMy4xMC1NYXJpYURCLTE6MTAuMy4xMCttYXJpYX5iaW9u&lt;/span&gt;
&lt;span class="s1"&gt;aWMtbG9nAAAAAAAAAAAAAAAAEzgNAAgAEgAEBAQEEgAA5AAEGggAAAAICAgCAAAACgoKAAAAAAAA&lt;/span&gt;
&lt;span class="s1"&gt;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&lt;/span&gt;
&lt;span class="s1"&gt;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&lt;/span&gt;
&lt;span class="s1"&gt;AAAAAAAAAAAEEwQADQgICAoKCgHuNUWf&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;/*!*/&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="c1"&gt;# at 67582355&lt;/span&gt;
&lt;span class="c1"&gt;#190710  8:52:12 server id 1  end_log_pos 67584614 CRC32 0x0cc5dedc     Query   thread_id=2003941       exec_time=0     error_code=0&lt;/span&gt;
use &lt;span class="sb"&gt;`&lt;/span&gt;fact_contract&lt;span class="sb"&gt;`&lt;/span&gt;/*!*/&lt;span class="p"&gt;;&lt;/span&gt;
SET &lt;span class="nv"&gt;TIMESTAMP&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1562748732&lt;/span&gt;/*!*/&lt;span class="p"&gt;;&lt;/span&gt;
SET @@session.pseudo_thread_id&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;2003941&lt;/span&gt;/*!*/&lt;span class="p"&gt;;&lt;/span&gt;
SET @@session.foreign_key_checks&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;, @@session.sql_auto_is_null&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;, @@session.unique_checks&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;, @@session.autocommit&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;, @@session.check_constraint_checks&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;/*!*/&lt;span class="p"&gt;;&lt;/span&gt;
SET @@session.sql_mode&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1411383304&lt;/span&gt;/*!*/&lt;span class="p"&gt;;&lt;/span&gt;
SET @@session.auto_increment_increment&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;, @@session.auto_increment_offset&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;/*!*/&lt;span class="p"&gt;;&lt;/span&gt;
/*!&lt;span class="se"&gt;\C&lt;/span&gt; utf8mb4 *//*!*/&lt;span class="p"&gt;;&lt;/span&gt;
SET @@session.character_set_client&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;45&lt;/span&gt;,@@session.collation_connection&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;45&lt;/span&gt;,@@session.collation_server&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;8&lt;/span&gt;/*!*/&lt;span class="p"&gt;;&lt;/span&gt;
SET @@session.lc_time_names&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;/*!*/&lt;span class="p"&gt;;&lt;/span&gt;
SET @@session.collation_database&lt;span class="o"&gt;=&lt;/span&gt;DEFAULT/*!*/&lt;span class="p"&gt;;&lt;/span&gt;
CREATE TABLE &lt;span class="sb"&gt;`&lt;/span&gt;instance&lt;span class="sb"&gt;`&lt;/span&gt;  &lt;span class="o"&gt;(&lt;/span&gt;
  &lt;span class="sb"&gt;`&lt;/span&gt;id&lt;span class="sb"&gt;`&lt;/span&gt; varchar&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;32&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT &lt;span class="s1"&gt;&amp;#39;主键ID&amp;#39;&lt;/span&gt;,
  &lt;span class="sb"&gt;`&lt;/span&gt;name&lt;span class="sb"&gt;`&lt;/span&gt; varchar&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;255&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT &lt;span class="s1"&gt;&amp;#39;合同名称&amp;#39;&lt;/span&gt;,
  &lt;span class="sb"&gt;`&lt;/span&gt;templateId&lt;span class="sb"&gt;`&lt;/span&gt; varchar&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;32&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT &lt;span class="s1"&gt;&amp;#39;合同模板ID&amp;#39;&lt;/span&gt;,
  &lt;span class="sb"&gt;`&lt;/span&gt;contractNo&lt;span class="sb"&gt;`&lt;/span&gt; varchar&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT &lt;span class="s1"&gt;&amp;#39;合同编号&amp;#39;&lt;/span&gt;,
  &lt;span class="sb"&gt;`&lt;/span&gt;docNo&lt;span class="sb"&gt;`&lt;/span&gt; varchar&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT &lt;span class="s1"&gt;&amp;#39;单据编号&amp;#39;&lt;/span&gt;,
  &lt;span class="sb"&gt;`&lt;/span&gt;docType&lt;span class="sb"&gt;`&lt;/span&gt; varchar&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;32&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT &lt;span class="s1"&gt;&amp;#39;单据类型（\&amp;quot;0 订单\n1 结算票\n2 发票\n3 付款承诺\n4 其他\&amp;quot;）&amp;#39;&lt;/span&gt;,
  &lt;span class="sb"&gt;`&lt;/span&gt;ccy&lt;span class="sb"&gt;`&lt;/span&gt; varchar&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;32&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT &lt;span class="s1"&gt;&amp;#39;币种\r\n&amp;#39;&lt;/span&gt;,
  &lt;span class="sb"&gt;`&lt;/span&gt;parAmt&lt;span class="sb"&gt;`&lt;/span&gt; varchar&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;24&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT &lt;span class="s1"&gt;&amp;#39;票面金额\r\n&amp;#39;&lt;/span&gt;,
  &lt;span class="sb"&gt;`&lt;/span&gt;accountReceiveAmt&lt;span class="sb"&gt;`&lt;/span&gt; varchar&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;24&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT &lt;span class="s1"&gt;&amp;#39;应收账款金额\r\n&amp;#39;&lt;/span&gt;,
  &lt;span class="sb"&gt;`&lt;/span&gt;accountBegDate&lt;span class="sb"&gt;`&lt;/span&gt; datetime&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; NULL DEFAULT NULL COMMENT &lt;span class="s1"&gt;&amp;#39;账款起始日\r\n&amp;#39;&lt;/span&gt;,
  &lt;span class="sb"&gt;`&lt;/span&gt;accountEndDate&lt;span class="sb"&gt;`&lt;/span&gt; datetime&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; NULL DEFAULT NULL COMMENT &lt;span class="s1"&gt;&amp;#39;账款到期日\r\n&amp;#39;&lt;/span&gt;,
  &lt;span class="sb"&gt;`&lt;/span&gt;payTerm&lt;span class="sb"&gt;`&lt;/span&gt; varchar&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;32&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT &lt;span class="s1"&gt;&amp;#39;付款条件\r\n&amp;#39;&lt;/span&gt;,
  &lt;span class="sb"&gt;`&lt;/span&gt;draftDate&lt;span class="sb"&gt;`&lt;/span&gt; datetime&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; NULL DEFAULT NULL COMMENT &lt;span class="s1"&gt;&amp;#39;发票日\r\n&amp;#39;&lt;/span&gt;,
  &lt;span class="sb"&gt;`&lt;/span&gt;inspectionDate&lt;span class="sb"&gt;`&lt;/span&gt; datetime&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; NULL DEFAULT NULL COMMENT &lt;span class="s1"&gt;&amp;#39;验货日\r\n&amp;#39;&lt;/span&gt;,
  &lt;span class="sb"&gt;`&lt;/span&gt;payDays&lt;span class="sb"&gt;`&lt;/span&gt; varchar&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;24&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT &lt;span class="s1"&gt;&amp;#39;付款天数\r\n&amp;#39;&lt;/span&gt;,
  &lt;span class="sb"&gt;`&lt;/span&gt;createdBy&lt;span class="sb"&gt;`&lt;/span&gt; varchar&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT &lt;span class="s1"&gt;&amp;#39;记录创建人账号ID&amp;#39;&lt;/span&gt;,
  &lt;span class="sb"&gt;`&lt;/span&gt;createdAt&lt;span class="sb"&gt;`&lt;/span&gt; datetime&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; NULL DEFAULT current_timestamp&lt;span class="o"&gt;()&lt;/span&gt; COMMENT &lt;span class="s1"&gt;&amp;#39;记录创建时间&amp;#39;&lt;/span&gt;,
  &lt;span class="sb"&gt;`&lt;/span&gt;modifiedBy&lt;span class="sb"&gt;`&lt;/span&gt; varchar&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT &lt;span class="s1"&gt;&amp;#39;记录修改人账号ID&amp;#39;&lt;/span&gt;,
  &lt;span class="sb"&gt;`&lt;/span&gt;modifiedAt&lt;span class="sb"&gt;`&lt;/span&gt; datetime&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; NULL DEFAULT NULL COMMENT &lt;span class="s1"&gt;&amp;#39;记录修改时间&amp;#39;&lt;/span&gt;,
  PRIMARY KEY &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;id&lt;span class="sb"&gt;`&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; USING BTREE
&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="nv"&gt;ENGINE&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; InnoDB CHARACTER &lt;span class="nv"&gt;SET&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; utf8 &lt;span class="nv"&gt;COLLATE&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; utf8_general_ci &lt;span class="nv"&gt;COMMENT&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;合同实例表&amp;#39;&lt;/span&gt; &lt;span class="nv"&gt;ROW_FORMAT&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; Dynamic
/*!*/&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="c1"&gt;# at 67584614&lt;/span&gt;
&lt;span class="c1"&gt;#190710  8:52:12 server id 1  end_log_pos 67584656 CRC32 0x8b622d76     GTID 0-1-1455487 ddl&lt;/span&gt;
/*!100101 SET @@session.skip_parallel_replication&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;*//*!*/&lt;span class="p"&gt;;&lt;/span&gt;
/*!100001 SET @@session.gtid_domain_id&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;*//*!*/&lt;span class="p"&gt;;&lt;/span&gt;
/*!100001 SET @@session.server_id&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;*//*!*/&lt;span class="p"&gt;;&lt;/span&gt;
/*!100001 SET @@session.gtid_seq_no&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1455487&lt;/span&gt;*//*!*/&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="c1"&gt;# at 67584656&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;可以看到是一个数据库创建语句,里面有字段&lt;code&gt;datetime(0)&lt;/code&gt;, 之前一直创建表的时候,使用的&lt;code&gt;datetime&lt;/code&gt;的时候, 都是直接使用,没有使用过&lt;code&gt;datetime(0)&lt;/code&gt;这种写法. 使用上面的SQL语句执行,发现可以创建成功,同时CDC报错.验证了之前的CDC的错误.&lt;/p&gt;
&lt;p&gt;寻找相关资料,发现Mysql中支持这种写法,&lt;a href="https://dev.mysql.com/doc/refman/8.0/en/date-and-time-type-overview.html"&gt;相关链接&lt;/a&gt;.括号里面的值表示时间的秒后面保留的微秒的精度,取值范围是0-6,如果为0的话,可以默认不写.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;#&lt;/span&gt; &lt;span class="k"&gt;create&lt;/span&gt; &lt;span class="k"&gt;table&lt;/span&gt;
&lt;span class="n"&gt;mysql&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;TABLE&lt;/span&gt; &lt;span class="n"&gt;t1&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt; &lt;span class="n"&gt;TIME&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;dt&lt;/span&gt; &lt;span class="n"&gt;DATETIME&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="n"&gt;dt1&lt;/span&gt; &lt;span class="n"&gt;DATETIME&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="n"&gt;dt2&lt;/span&gt; &lt;span class="n"&gt;DATETIME&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;dt3&lt;/span&gt; &lt;span class="n"&gt;DATETIME&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;dt4&lt;/span&gt; &lt;span class="n"&gt;DATETIME&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;dt5&lt;/span&gt; &lt;span class="n"&gt;DATETIME&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;dt6&lt;/span&gt; &lt;span class="n"&gt;DATETIME&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;

&lt;span class="n"&gt;mysql&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;desc&lt;/span&gt; &lt;span class="n"&gt;t1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;-------+-------------+------+-----+---------+-------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Field&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="k"&gt;Type&lt;/span&gt;        &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="k"&gt;Null&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="k"&gt;Key&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="k"&gt;Default&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Extra&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;-------+-------------+------+-----+---------+-------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt;     &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;     &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;YES&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt;     &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="k"&gt;NULL&lt;/span&gt;    &lt;span class="o"&gt;|&lt;/span&gt;       &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;dt&lt;/span&gt;    &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;    &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;YES&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt;     &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="k"&gt;NULL&lt;/span&gt;    &lt;span class="o"&gt;|&lt;/span&gt;       &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;dt1&lt;/span&gt;   &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;YES&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt;     &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="k"&gt;NULL&lt;/span&gt;    &lt;span class="o"&gt;|&lt;/span&gt;       &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;dt2&lt;/span&gt;   &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;YES&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt;     &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="k"&gt;NULL&lt;/span&gt;    &lt;span class="o"&gt;|&lt;/span&gt;       &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;dt3&lt;/span&gt;   &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;YES&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt;     &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="k"&gt;NULL&lt;/span&gt;    &lt;span class="o"&gt;|&lt;/span&gt;       &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;dt4&lt;/span&gt;   &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;YES&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt;     &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="k"&gt;NULL&lt;/span&gt;    &lt;span class="o"&gt;|&lt;/span&gt;       &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;dt5&lt;/span&gt;   &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;YES&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt;     &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="k"&gt;NULL&lt;/span&gt;    &lt;span class="o"&gt;|&lt;/span&gt;       &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;dt6&lt;/span&gt;   &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;YES&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt;     &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="k"&gt;NULL&lt;/span&gt;    &lt;span class="o"&gt;|&lt;/span&gt;       &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;-------+-------------+------+-----+---------+-------+&lt;/span&gt;
&lt;span class="mi"&gt;8&lt;/span&gt; &lt;span class="k"&gt;rows&lt;/span&gt; &lt;span class="k"&gt;in&lt;/span&gt; &lt;span class="k"&gt;set&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;05&lt;/span&gt; &lt;span class="n"&gt;sec&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;mysql&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;select&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;from&lt;/span&gt; &lt;span class="n"&gt;t1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;--------------+---------------------+-----------------------+------------------------+-------------------------+--------------------------+---------------------------+----------------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt;            &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;dt&lt;/span&gt;                  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;dt1&lt;/span&gt;                   &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;dt2&lt;/span&gt;                    &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;dt3&lt;/span&gt;                     &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;dt4&lt;/span&gt;                      &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;dt5&lt;/span&gt;                       &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;dt6&lt;/span&gt;                        &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;--------------+---------------------+-----------------------+------------------------+-------------------------+--------------------------+---------------------------+----------------------------+&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;18&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;44&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;000&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2019&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;07&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;19&lt;/span&gt; &lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;18&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;46&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2019&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;07&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;19&lt;/span&gt; &lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;18&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;49&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2019&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;07&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;19&lt;/span&gt; &lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;18&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;51&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;00&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2019&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;07&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;19&lt;/span&gt; &lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;18&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;52&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;000&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2019&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;07&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;19&lt;/span&gt; &lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;18&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;54&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;0000&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2019&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;07&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;19&lt;/span&gt; &lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;18&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;57&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;00000&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="mi"&gt;2019&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;07&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;19&lt;/span&gt; &lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;19&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;00&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;000000&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="c1"&gt;--------------+---------------------+-----------------------+------------------------+-------------------------+--------------------------+---------------------------+----------------------------+&lt;/span&gt;
&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="k"&gt;rows&lt;/span&gt; &lt;span class="k"&gt;in&lt;/span&gt; &lt;span class="k"&gt;set&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;04&lt;/span&gt; &lt;span class="n"&gt;sec&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;既然Mysql支持,那就是Debezium解析的时候,逻辑不严谨报错了.查看Debezium的代码.我们当前使用的Debezium的版本是v0.94.Final.&lt;/p&gt;
&lt;p&gt;追踪代码,发现在Debeziume的代码中,MySqlDefaultValuePreConverter类中,会对默认值进行转换,当为时间类型的时候,使用了JDK中的DateTimeFormatterBuilder,该类在format的时候,可以指定保留的微秒的位数.具体代码如下:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt; &lt;span class="n"&gt;DateTimeFormatter&lt;/span&gt; &lt;span class="nf"&gt;timestampFormat&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;length&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
        &lt;span class="kd"&gt;final&lt;/span&gt; &lt;span class="n"&gt;DateTimeFormatterBuilder&lt;/span&gt; &lt;span class="n"&gt;dtf&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;DateTimeFormatterBuilder&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt;
                &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;appendPattern&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;yyyy-MM-dd HH:mm:ss&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;length&lt;/span&gt; &lt;span class="o"&gt;!=-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
            &lt;span class="n"&gt;dtf&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;appendFraction&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ChronoField&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;MICRO_OF_SECOND&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;length&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
        &lt;span class="o"&gt;}&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;dtf&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toFormatter&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt;
    &lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;我们给datetime(0)的时候,该方法中的length值为0,而次方法中只进行length不等于-1的判断,所以会执行appendFraction方法&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="n"&gt;DateTimeFormatterBuilder&lt;/span&gt; &lt;span class="nf"&gt;appendFraction&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;
            &lt;span class="n"&gt;TemporalField&lt;/span&gt; &lt;span class="n"&gt;field&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;minWidth&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;maxWidth&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;boolean&lt;/span&gt; &lt;span class="n"&gt;decimalPoint&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
        &lt;span class="n"&gt;appendInternal&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;FractionPrinterParser&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;field&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;minWidth&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;maxWidth&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;decimalPoint&lt;/span&gt;&lt;span class="o"&gt;));&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
    &lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="n"&gt;FractionPrinterParser&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;TemporalField&lt;/span&gt; &lt;span class="n"&gt;field&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;minWidth&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;maxWidth&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;boolean&lt;/span&gt; &lt;span class="n"&gt;decimalPoint&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
            &lt;span class="n"&gt;Objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;requireNonNull&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;field&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;field&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;field&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;range&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;isFixed&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
                &lt;span class="k"&gt;throw&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;IllegalArgumentException&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Field must have a fixed set of values: &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;field&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
            &lt;span class="o"&gt;}&lt;/span&gt;
            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;minWidth&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="n"&gt;minWidth&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
                &lt;span class="k"&gt;throw&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;IllegalArgumentException&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Minimum width must be from 0 to 9 inclusive but was &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;minWidth&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
            &lt;span class="o"&gt;}&lt;/span&gt;
            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;maxWidth&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="n"&gt;maxWidth&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
                &lt;span class="k"&gt;throw&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;IllegalArgumentException&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Maximum width must be from 1 to 9 inclusive but was &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;maxWidth&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
            &lt;span class="o"&gt;}&lt;/span&gt;
            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;maxWidth&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;minWidth&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
                &lt;span class="k"&gt;throw&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;IllegalArgumentException&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Maximum width must exceed or equal the minimum width but &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt;
                        &lt;span class="n"&gt;maxWidth&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s"&gt;&amp;quot; &amp;lt; &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;minWidth&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
            &lt;span class="o"&gt;}&lt;/span&gt;
            &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;field&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;field&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
            &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;minWidth&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;minWidth&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
            &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;maxWidth&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;maxWidth&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
            &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;decimalPoint&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;decimalPoint&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
        &lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;该方法在length &amp;lt; 1 的时候会报错,从而导致connector悬起来了.发现在Debezium在后面的版本中,即v0.9.5.Final中已经修复了该问题,修复代码如下:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt; &lt;span class="n"&gt;DateTimeFormatter&lt;/span&gt; &lt;span class="nf"&gt;timestampFormat&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;length&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
        &lt;span class="kd"&gt;final&lt;/span&gt; &lt;span class="n"&gt;DateTimeFormatterBuilder&lt;/span&gt; &lt;span class="n"&gt;dtf&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;DateTimeFormatterBuilder&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt;
                &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;appendPattern&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;yyyy-MM-dd HH:mm:ss&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;length&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
            &lt;span class="n"&gt;dtf&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;appendFraction&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ChronoField&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;MICRO_OF_SECOND&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;length&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
        &lt;span class="o"&gt;}&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;dtf&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toFormatter&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt;
    &lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;所以在v0.9.5.Final及以后的版本,应该不会出现该问题.&lt;/p&gt;
&lt;h2&gt;参考&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://dev.mysql.com/doc/refman/8.0/en/date-and-time-type-overview.html"&gt;https://dev.mysql.com/doc/refman/8.0/en/date-and-time-type-overview.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://dev.mysql.com/doc/refman/8.0/en/timestamp-initialization.html"&gt;https://dev.mysql.com/doc/refman/8.0/en/timestamp-initialization.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/debezium/debezium/"&gt;https://github.com/debezium/debezium/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://debezium.io/docs/connectors/mysql/#enabling-gtids-optional"&gt;https://debezium.io/docs/connectors/mysql/#enabling-gtids-optional&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><category term="database"></category><category term="debezium"></category></entry><entry><title>MysqlBinlog 详解</title><link href="xixuebin.github.io/2019-06-19-193732-ch.html" rel="alternate"></link><published>2019-06-19T19:37:32+08:00</published><updated>2019-06-19T19:37:32+08:00</updated><author><name>kevin.xi</name></author><id>tag:None,2019-06-19:xixuebin.github.io/2019-06-19-193732-ch.html</id><summary type="html">&lt;p&gt;Summary&lt;/p&gt;</summary><content type="html">&lt;!-- https://code.visualstudio.com/docs/editor/userdefinedsnippets --&gt;

&lt;blockquote&gt;
&lt;p&gt;Mariadb/mysql提供了4中不同的日志，分别是错误日志（error.log）、普通日志（general log）、慢日志（slow log）以及二进制日志（binlog）。错误日志记录了系统启动、运行以及停止过程中遇到的一些问题；普通日志记录了Mariadb执行的所有语句以及语句开始执行的时间等信息，用户可以选择性的打开它；慢日志记录了Mariadb所有慢查询的相关信息；而二进制日志则以事件的形式记录了mariadb的库表结构以及表数据的所有变更信息。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Mysql Binlog&lt;/h1&gt;
&lt;h2&gt;binlog的作用&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;复制&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在Mariadb/mysql的主从结构中，主库的binlog记录了主库的所有更改操作，从库通过读取主库的binlog，在本地重放获取的binlog，这样从库就拥有和主库相同的数据，达到复制目的。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;备份恢复&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;binlog记录了数据库的所有更改信息，所以当Mariadb/mysql发生崩溃的时候，能够以最近备份点作为起点，然后执行在备份点之后产生的binlog中所有事件，实现数据库最大可能的恢复。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;index文件按照书序记录了Mariadb/Mysql使用的所有binlog文件，管理binlog文件。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;binlog操作&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# 查看binlog&lt;/span&gt;
mysql&amp;gt; show binary logs&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="c1"&gt;# 查看binlog事件&lt;/span&gt;
mysql&amp;gt; show binary events&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;binlog配置&lt;/h2&gt;
&lt;p&gt;binlog的配置在mysql的配置文件中,默认的配置文件是&lt;code&gt;/etc/my.cnf&lt;/code&gt;.相关配置项&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;expire_logs_days&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;5&lt;/span&gt; &lt;span class="c1"&gt;#配置定情清理&lt;/span&gt;
log-bin&lt;span class="o"&gt;=&lt;/span&gt;/var/mysql/mysql-bin &lt;span class="c1"&gt;# bin log日志路径&lt;/span&gt;
&lt;span class="nv"&gt;binlog_format&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;ROW
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;修改完成之后必须重启,才能生效&lt;/p&gt;
&lt;h2&gt;binlog常用命令&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;#0 查看日志开启状态 show variables like &amp;#39;log_%&amp;#39;;&lt;/span&gt;
mysql&amp;gt; show variables like &lt;span class="s1"&gt;&amp;#39;log_%&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
+-------------------------------------------------------------------------------------------------------------------------------------+
&lt;span class="p"&gt;|&lt;/span&gt; Variable_name                   &lt;span class="p"&gt;|&lt;/span&gt; Value                                                                                             &lt;span class="p"&gt;|&lt;/span&gt;
+-------------------------------------------------------------------------------------------------------------------------------------+
&lt;span class="p"&gt;|&lt;/span&gt; log_bin                         &lt;span class="p"&gt;|&lt;/span&gt; ON                                                                                                &lt;span class="p"&gt;|&lt;/span&gt;
&lt;span class="p"&gt;|&lt;/span&gt; log_bin_basename                &lt;span class="p"&gt;|&lt;/span&gt; /var/log/mysql/mariadb-bin                                                                        &lt;span class="p"&gt;|&lt;/span&gt;
&lt;span class="p"&gt;|&lt;/span&gt; log_bin_compress                &lt;span class="p"&gt;|&lt;/span&gt; OFF                                                                                               &lt;span class="p"&gt;|&lt;/span&gt;
&lt;span class="p"&gt;|&lt;/span&gt; log_bin_compress_min_len        &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="m"&gt;256&lt;/span&gt;                                                                                               &lt;span class="p"&gt;|&lt;/span&gt;
&lt;span class="p"&gt;|&lt;/span&gt; log_bin_index                   &lt;span class="p"&gt;|&lt;/span&gt; /var/log/mysql/mariadb-bin.index                                                                  &lt;span class="p"&gt;|&lt;/span&gt;
&lt;span class="p"&gt;|&lt;/span&gt; log_bin_trust_function_creators &lt;span class="p"&gt;|&lt;/span&gt; OFF                                                                                               &lt;span class="p"&gt;|&lt;/span&gt;
&lt;span class="p"&gt;|&lt;/span&gt; log_disabled_statements         &lt;span class="p"&gt;|&lt;/span&gt; sp                                                                                                &lt;span class="p"&gt;|&lt;/span&gt;
&lt;span class="p"&gt;|&lt;/span&gt; log_error                       &lt;span class="p"&gt;|&lt;/span&gt;                                                                                                   &lt;span class="p"&gt;|&lt;/span&gt;
&lt;span class="p"&gt;|&lt;/span&gt; log_output                      &lt;span class="p"&gt;|&lt;/span&gt; FILE                                                                                              &lt;span class="p"&gt;|&lt;/span&gt;
&lt;span class="p"&gt;|&lt;/span&gt; log_queries_not_using_indexes   &lt;span class="p"&gt;|&lt;/span&gt; OFF                                                                                               &lt;span class="p"&gt;|&lt;/span&gt;
&lt;span class="p"&gt;|&lt;/span&gt; log_slave_updates               &lt;span class="p"&gt;|&lt;/span&gt; OFF                                                                                               &lt;span class="p"&gt;|&lt;/span&gt;
&lt;span class="p"&gt;|&lt;/span&gt; log_slow_admin_statements       &lt;span class="p"&gt;|&lt;/span&gt; ON                                                                                                &lt;span class="p"&gt;|&lt;/span&gt;
&lt;span class="p"&gt;|&lt;/span&gt; log_slow_disabled_statements    &lt;span class="p"&gt;|&lt;/span&gt; sp                                                                                                &lt;span class="p"&gt;|&lt;/span&gt;
&lt;span class="p"&gt;|&lt;/span&gt; log_slow_filter                 &lt;span class="p"&gt;|&lt;/span&gt; admin,filesort,filesort_on_disk,filesort_priority_queue,...,query_cache_miss,tmp_table            &lt;span class="p"&gt;|&lt;/span&gt;
&lt;span class="p"&gt;|&lt;/span&gt; log_slow_rate_limit             &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;                                                                                                 &lt;span class="p"&gt;|&lt;/span&gt;
&lt;span class="p"&gt;|&lt;/span&gt; log_slow_slave_statements       &lt;span class="p"&gt;|&lt;/span&gt; ON                                                                                                &lt;span class="p"&gt;|&lt;/span&gt;
&lt;span class="p"&gt;|&lt;/span&gt; log_slow_verbosity              &lt;span class="p"&gt;|&lt;/span&gt;                                                                                                   &lt;span class="p"&gt;|&lt;/span&gt;
&lt;span class="p"&gt;|&lt;/span&gt; log_tc_size                     &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="m"&gt;24576&lt;/span&gt;                                                                                             &lt;span class="p"&gt;|&lt;/span&gt;
&lt;span class="p"&gt;|&lt;/span&gt; log_warnings                    &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="m"&gt;2&lt;/span&gt;                                                                                                 &lt;span class="p"&gt;|&lt;/span&gt;
+-------------------------------------------------------------------------------------------------------------------------------------+
&lt;span class="m"&gt;19&lt;/span&gt; rows in &lt;span class="nb"&gt;set&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;.05 sec&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;# 查看所有日志&lt;/span&gt;
mysql&amp;gt; show master logs&lt;span class="p"&gt;;&lt;/span&gt;
+--------------------+-----------+
&lt;span class="p"&gt;|&lt;/span&gt; Log_name           &lt;span class="p"&gt;|&lt;/span&gt; File_size &lt;span class="p"&gt;|&lt;/span&gt;
+--------------------+-----------+
&lt;span class="p"&gt;|&lt;/span&gt; mariadb-bin.000017 &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="m"&gt;104858004&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt;
&lt;span class="p"&gt;|&lt;/span&gt; mariadb-bin.000018 &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="m"&gt;105248607&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt;
&lt;span class="p"&gt;|&lt;/span&gt; mariadb-bin.000019 &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="m"&gt;105317664&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt;
&lt;span class="p"&gt;|&lt;/span&gt; mariadb-bin.000020 &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="m"&gt;105143468&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt;
&lt;span class="p"&gt;|&lt;/span&gt; mariadb-bin.000021 &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="m"&gt;104857727&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt;
&lt;span class="p"&gt;|&lt;/span&gt; mariadb-bin.000022 &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="m"&gt;104915425&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt;
&lt;span class="p"&gt;|&lt;/span&gt; mariadb-bin.000023 &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="m"&gt;94849361&lt;/span&gt;  &lt;span class="p"&gt;|&lt;/span&gt;
+--------------------+-----------+
&lt;span class="m"&gt;7&lt;/span&gt; rows in &lt;span class="nb"&gt;set&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;.09 sec&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;#查看最新一个binlog日志的编号名称，及其最后一个操作事件结束点 show master status;&lt;/span&gt;
mysql&amp;gt; show master status&lt;span class="p"&gt;;&lt;/span&gt;
+--------------------+----------+--------------+------------------+
&lt;span class="p"&gt;|&lt;/span&gt; File               &lt;span class="p"&gt;|&lt;/span&gt; Position &lt;span class="p"&gt;|&lt;/span&gt; Binlog_Do_DB &lt;span class="p"&gt;|&lt;/span&gt; Binlog_Ignore_DB &lt;span class="p"&gt;|&lt;/span&gt;
+--------------------+----------+--------------+------------------+
&lt;span class="p"&gt;|&lt;/span&gt; mariadb-bin.000023 &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="m"&gt;94861723&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt;              &lt;span class="p"&gt;|&lt;/span&gt;                  &lt;span class="p"&gt;|&lt;/span&gt;
+--------------------+----------+--------------+------------------+
&lt;span class="m"&gt;1&lt;/span&gt; rows in &lt;span class="nb"&gt;set&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;.05 sec&lt;span class="o"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# 刷新log日志，立刻产生一个新编号的binlog日志文件，跟重启一个效果 flush logs;&lt;/span&gt;
&lt;span class="c1"&gt;# 清空所有binlog日志 reset master;&lt;/span&gt;

&lt;span class="c1"&gt;# 查看指定binlog文件的内容(show binlog events in &amp;#39;binname.xxxxx&amp;#39;)#&lt;/span&gt;
mysql&amp;gt; show binlog events in &lt;span class="s1"&gt;&amp;#39;mariadb-bin.000023&amp;#39;&lt;/span&gt; limit &lt;span class="m"&gt;4&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
+--------------------+-----+-------------------+-----------+-------------+-----------------------------------------------------------------------+
&lt;span class="p"&gt;|&lt;/span&gt; Log_name           &lt;span class="p"&gt;|&lt;/span&gt; Pos &lt;span class="p"&gt;|&lt;/span&gt; Event_type        &lt;span class="p"&gt;|&lt;/span&gt; Server_id &lt;span class="p"&gt;|&lt;/span&gt; End_log_pos &lt;span class="p"&gt;|&lt;/span&gt; Info                                                                  &lt;span class="p"&gt;|&lt;/span&gt;
+--------------------+-----+-------------------+-----------+-------------+-----------------------------------------------------------------------+
&lt;span class="p"&gt;|&lt;/span&gt; mariadb-bin.000023 &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="m"&gt;4&lt;/span&gt;   &lt;span class="p"&gt;|&lt;/span&gt; Format_desc       &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;         &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="m"&gt;256&lt;/span&gt;         &lt;span class="p"&gt;|&lt;/span&gt; Server ver: &lt;span class="m"&gt;10&lt;/span&gt;.3.10-MariaDB-1:10.3.10+maria~bionic-log, Binlog ver: &lt;span class="m"&gt;4&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt;
&lt;span class="p"&gt;|&lt;/span&gt; mariadb-bin.000023 &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="m"&gt;256&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; Gtid_list         &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;         &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="m"&gt;299&lt;/span&gt;         &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;-1-1650762&lt;span class="o"&gt;]&lt;/span&gt;                                                         &lt;span class="p"&gt;|&lt;/span&gt;
&lt;span class="p"&gt;|&lt;/span&gt; mariadb-bin.000023 &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="m"&gt;299&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; Binlog_checkpoint &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;         &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="m"&gt;344&lt;/span&gt;         &lt;span class="p"&gt;|&lt;/span&gt; mariadb-bin.000022                                                    &lt;span class="p"&gt;|&lt;/span&gt;
&lt;span class="p"&gt;|&lt;/span&gt; mariadb-bin.000023 &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="m"&gt;344&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; Gtid              &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;         &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="m"&gt;386&lt;/span&gt;         &lt;span class="p"&gt;|&lt;/span&gt; BEGIN GTID &lt;span class="m"&gt;0&lt;/span&gt;-1-1650763                                                &lt;span class="p"&gt;|&lt;/span&gt;
+--------------------+-----+-------------------+-----------+-------------+-----------------------------------------------------------------------+

&lt;span class="c1"&gt;# 获取指定位置binlog的内容(show binlog events from)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Mysqlbinlog方式提取binlog&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;#a、提取指定的binlog日志&lt;/span&gt;
&lt;span class="c1"&gt;# mysqlbinlog /opt/data/APP01bin.000001&lt;/span&gt;
&lt;span class="c1"&gt;# mysqlbinlog /opt/data/APP01bin.000001|grep insert&lt;/span&gt;
/*!40019 SET @@session.max_insert_delayed_threads&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;*/&lt;span class="p"&gt;;&lt;/span&gt;
insert into tb values&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;,&lt;span class="s1"&gt;&amp;#39;jack&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;#b、提取指定position位置的binlog日志&lt;/span&gt;
mysqlbinlog --start-position&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;120&amp;quot;&lt;/span&gt; --stop-position&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;332&amp;quot;&lt;/span&gt; /opt/data/APP01bin.000001
&lt;span class="c1"&gt;#c、提取指定position位置的binlog日志并输出到压缩文件&lt;/span&gt;
mysqlbinlog --start-position&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;120&amp;quot;&lt;/span&gt; --stop-position&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;332&amp;quot;&lt;/span&gt; /opt/data/APP01bin.000001 &lt;span class="p"&gt;|&lt;/span&gt;gzip &amp;gt;extra_01.sql.gz
&lt;span class="c1"&gt;#d、提取指定position位置的binlog日志导入数据库&lt;/span&gt;
mysqlbinlog --start-position&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;120&amp;quot;&lt;/span&gt; --stop-position&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;332&amp;quot;&lt;/span&gt; /opt/data/APP01bin.000001 &lt;span class="p"&gt;|&lt;/span&gt; mysql -uroot -p
&lt;span class="c1"&gt;#e、提取指定开始时间的binlog并输出到日志文件&lt;/span&gt;
mysqlbinlog --start-datetime&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;2014-12-15 20:15:23&amp;quot;&lt;/span&gt; /opt/data/APP01bin.000002 --result-file&lt;span class="o"&gt;=&lt;/span&gt;extra02.sql
&lt;span class="c1"&gt;#f、提取指定位置的多个binlog日志文件&lt;/span&gt;
mysqlbinlog --start-position&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;120&amp;quot;&lt;/span&gt; --stop-position&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;332&amp;quot;&lt;/span&gt; /opt/data/APP01bin.000001 /opt/data/APP01bin.000002&lt;span class="p"&gt;|&lt;/span&gt;more
&lt;span class="c1"&gt;#g、提取指定数据库binlog并转换字符集到UTF8&lt;/span&gt;
mysqlbinlog --database&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;test&lt;/span&gt; --set-charset&lt;span class="o"&gt;=&lt;/span&gt;utf8 /opt/data/APP01bin.000001 /opt/data/APP01bin.000002 &amp;gt;test.sql
&lt;span class="c1"&gt;#h、远程提取日志，指定结束时间 &lt;/span&gt;
mysqlbinlog -urobin -p -h192.168.1.116 -P3306 --stop-datetime&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;2014-12-15 20:30:23&amp;quot;&lt;/span&gt; --read-from-remote-server mysql-bin.000033 &lt;span class="p"&gt;|&lt;/span&gt;more
&lt;span class="c1"&gt;#i、远程提取使用row格式的binlog日志并输出到本地文件&lt;/span&gt;
mysqlbinlog -urobin -p -P3606 -h192.168.1.177 --read-from-remote-server -vv inst3606bin.000005 &amp;gt;row.sql
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;参考&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.51cto.com/6226001001/1672159"&gt;https://blog.51cto.com/6226001001/1672159&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://mariadb.com/kb/en/library/binary-log/"&gt;https://mariadb.com/kb/en/library/binary-log/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.cnblogs.com/skymyyang/p/7798670.html"&gt;https://www.cnblogs.com/skymyyang/p/7798670.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.csdn.net/leshami/article/details/41962243"&gt;https://blog.csdn.net/leshami/article/details/41962243&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.linuxidc.com/Linux/2018-01/150149.htm"&gt;https://www.linuxidc.com/Linux/2018-01/150149.htm&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><category term="database"></category><category term="binlog"></category><category term="mysql"></category></entry></feed>